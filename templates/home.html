<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Expense Tracker Dashboard - M3</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    
    <style>
        /* ... (Your existing CSS styles remain here) ... */
        :root {
            /* M3 Dynamic Color inspired tokens */
            --md-sys-color-primary: #6750A4; /* A primary purple for brand */
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-surface-container-low: #F7F2FA; /* Light surface color */
            --md-sys-color-surface-container-high: #EAE6EC;
            --md-sys-color-outline: #79747E;
            --md-sys-color-success: #4CAF50;
            --md-sys-color-info: #00BCD4;

            /* M3 Typography - using Roboto for simplicity */
            --md-sys-typescale-headline-medium: 700 1.5rem/2rem Roboto, sans-serif;
            --md-sys-typescale-body-large: 400 1rem/1.5rem Roboto, sans-serif;
            --md-sys-typescale-title-large: 500 1.25rem/1.75rem Roboto, sans-serif;
        }

        body {
            font: var(--md-sys-typescale-body-large);
            color: #1C1B1F; /* On-surface dark text */
            background-color: var(--md-sys-color-surface-container-low);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
        }
        
        main {
            flex: 1 0 auto;
            padding: 32px 24px;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        /* Top App Bar (M3-style - simple, distinct color) */
        header {
            background-color: var(--md-sys-color-surface-container-high);
            color: #1C1B1F; /* On-surface color */
            padding: 0 24px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); /* Softer shadow */
        }
        nav {
            display: flex;
            align-items: center;
            height: 64px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .brand-logo {
            font: var(--md-sys-typescale-title-large);
            font-weight: 700;
            text-decoration: none;
            color: #1C1B1F;
        }
        #nav-desktop {
            margin-left: auto;
            list-style: none;
            padding: 0;
            display: flex;
            gap: 24px;
        }
        #nav-desktop a {
            text-decoration: none;
            color: var(--md-sys-color-outline); /* Subtle link color */
            padding: 8px 0;
            font-weight: 500;
        }
        #nav-desktop a:hover {
            color: var(--md-sys-color-primary); /* Primary hover state */
        }

        /* Cards (M3 Elevated Card - rounded corners, soft shadow) */
        .card {
            background-color: white;
            border-radius: 16px; /* More rounded corners in M3 */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            padding: 24px;
            margin-bottom: 20px;
        }
        .card-title {
            font: var(--md-sys-typescale-headline-medium);
            margin: 0 0 16px 0;
        }
        
        /* Specific Card Styles (Emphasizing Dynamic Color) */
        .card.budget {
            background-color: var(--md-sys-color-surface-container-high);
            border: 1px solid var(--md-sys-color-primary); /* Subtle border for emphasis */
        }
        .card.expenses {
            background-color: var(--md-sys-color-surface-container-high);
            border: 1px solid var(--md-sys-color-success);
        }

        /* List (Collection replacement) */
        .data-list {
            list-style: none;
            padding: 0;
        }
        .data-list-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--md-sys-color-surface-container-low);
        }
        .data-list-item:last-child {
            border-bottom: none;
        }

        /* Footer (Simple M3 Footer) */
        footer {
            background-color: var(--md-sys-color-surface-container-high);
            color: var(--md-sys-color-outline);
            padding: 16px 24px;
            text-align: center;
        }

        /* Row/Column basic grid (simplified for this example) */
        .row { display: flex; flex-wrap: wrap; margin: 0 -10px; }
        .col { padding: 0 10px; width: 100%; }
        @media (min-width: 600px) {
            .col.m6 { width: 50%; }
        }

        /* Primary Button (M3 Filled Button) */
        .button-primary {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            padding: 10px 24px;
            border: none;
            border-radius: 20px; /* Fully rounded 'pill' shape */
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .button-primary:hover {
            background-color: #7A66C6; /* Slightly darker hover */
        }
        /* New style for the "Set Budget" button when budget is missing (can be the same or different) */
        .button-secondary {
            background-color: #EFB8C8; /* A contrasting M3 color for emphasis (e.g., secondary) */
            color: #492532;
            padding: 10px 24px;
            border: none;
            border-radius: 20px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .button-secondary:hover {
            background-color: #F8DAE1;
        }
    </style>
</head>
<body>

    <header>
        <nav>
            <a href="{{ url_for('home') }}" class="brand-logo">
                <span class="material-symbols-outlined">payments</span>
                Expense Tracker
            </a>
            <ul id="nav-desktop">
                <li><a href="{{ url_for('set_budget') }}">Set Budget</a></li>
                <li><a href="{{ url_for('add_expense') }}">Add Expense</a></li>
                <li><a href="{{ url_for('show_report') }}">Report</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h2 style="font: var(--md-sys-typescale-headline-medium); margin-bottom: 8px;">Welcome to Your Dashboard</h2>
        <p style="color: var(--md-sys-color-outline);">Manage your budget and expenses effectively.</p>

        <div class="row" style="margin-top: 24px;">
            <div class="col m12" style="margin-bottom: 24px;">
                
                {# --- START OF DYNAMIC BUTTON LOGIC --- #}
                {% if budget %}
                {# Budget exists: Show Add Expense button #}
                <a href="{{ url_for('add_expense') }}" class="button-primary">
                    <span class="material-symbols-outlined">add</span>
                    **Add New Expense**
                </a>
                {% else %}
                {# No budget: Show Set Budget button #}
                <a href="{{ url_for('set_budget') }}" class="button-secondary">
                    <span class="material-symbols-outlined">account_balance_wallet</span>
                    <b>Set Your Monthly Budget First!</b>
                </a>
                {% endif %}
                {# --- END OF DYNAMIC BUTTON LOGIC --- #}

            </div>
            
            <div class="col m6">
                <div class="card budget">
                    <h3 class="card-title">Monthly Budget</h3>
                    <ul class="data-list">
                        {% if budget %}
                            {% for category, amount in budget.items() %}
                            <li class="data-list-item">
                                <span>{{ category }}</span>
                                <span style="font-weight: 500;">₹{{ '%.2f' % amount }}</span>
                            </li>
                            {% endfor %}
                        {% else %}
                            <li class="data-list-item" style="color: var(--md-sys-color-outline);">
                                No budget set yet. **Click "Set Your Monthly Budget First!" above.**
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </div>

            <div class="col m6">
                <div class="card expenses">
                    <h3 class="card-title">Recent Expenses</h3>
                    <ul class="data-list">
                        {% if expenses %}
                            {# Show only the last 5 expenses #}
                            {% for e in expenses[-5:] | reverse %} 
                                <li class="data-list-item">
                                    <span>{{ e['category'] }}</span>
                                    <span style="font-weight: 500; color: #7B7581;">
                                    ₹{{ "%.2f"|format(e['amount']) }} - {{ e['date'] }}
                                    </span>
                                </li>
                            {% endfor %}
                        {% else %}
                            <li class="data-list-item" style="color: var(--md-sys-color-outline);">
                                No expenses added yet.
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <footer>
        &copy; 2025 Expense Tracker | Designed with Material Design 3 principles
    </footer>
    
</body>
</html>